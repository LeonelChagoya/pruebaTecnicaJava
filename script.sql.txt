-- Creación de tablas para el sistema bibliotecario
CREATE TABLE Roles (
    id_rol NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    nombre_rol VARCHAR2(50) NOT NULL UNIQUE,
    estado NUMBER(1) DEFAULT 1 
);

CREATE TABLE Usuarios (
    id_usuario NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    username VARCHAR2(50) NOT NULL UNIQUE,
    password VARCHAR2(255) NOT NULL,
    nombre VARCHAR(255) NOT NULL,
    apellido_paterno VARCHAR(255),
    apellido_materno VARCHAR(255),
    email VARCHAR2(100) UNIQUE,
    fecha_registro DATE DEFAULT SYSDATE,
    estado NUMBER(1) DEFAULT 1 );

CREATE TABLE Usuarios_Roles (
    id_usuario NUMBER NOT NULL,
    id_rol NUMBER NOT NULL,
    estado NUMBER(1) DEFAULT 1,
    PRIMARY KEY (id_usuario, id_rol),
    FOREIGN KEY (id_usuario) REFERENCES Usuarios(id_usuario),
    FOREIGN KEY (id_rol) REFERENCES Roles(id_rol)
);

CREATE TABLE Catalogo_Libros (
    id_libro NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    titulo VARCHAR2(150) NOT NULL,
    autor VARCHAR2(100) NOT NULL,
    genero VARCHAR2(50),
    isbn VARCHAR2(20) UNIQUE,
    descripcion CLOB,
    fecha_publicacion DATE,
    estado NUMBER(1) DEFAULT 1
);

CREATE TABLE Inventario_Libros (
    id_inventario NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    id_libro NUMBER NOT NULL,
    cantidad_total NUMBER DEFAULT 0,
    cantidad_disponible NUMBER DEFAULT 0,
    estado NUMBER(1) DEFAULT 1,
    FOREIGN KEY (id_libro) REFERENCES Catalogo_Libros(id_libro)
);

CREATE TABLE Prestamos (
    id_prestamo NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    id_usuario NUMBER NOT NULL,
    id_libro NUMBER NOT NULL,
    fecha_prestamo DATE DEFAULT SYSDATE,
    fecha_devolucion DATE,
    estado_prestamo NUMBER(1) DEFAULT 0, -- 0 =  en préstamo, 1 = devuelto
    estado NUMBER(1) DEFAULT 1,
    FOREIGN KEY (id_usuario) REFERENCES Usuarios(id_usuario),
    FOREIGN KEY (id_libro) REFERENCES Catalogo_Libros(id_libro)
);



-- Inserción de datos iniciales
INSERT INTO Roles (nombre_rol) VALUES ('Administrador');
INSERT INTO Roles (nombre_rol) VALUES ('Estudiante');

